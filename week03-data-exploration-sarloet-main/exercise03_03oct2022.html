<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Hubert Rehrauer">
<meta name="dcterms.date" content="2022-10-03">

<title>Exercise 03</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="exercise03_03oct2022_files/libs/clipboard/clipboard.min.js"></script>
<script src="exercise03_03oct2022_files/libs/quarto-html/quarto.js"></script>
<script src="exercise03_03oct2022_files/libs/quarto-html/popper.min.js"></script>
<script src="exercise03_03oct2022_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="exercise03_03oct2022_files/libs/quarto-html/anchor.min.js"></script>
<link href="exercise03_03oct2022_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="exercise03_03oct2022_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="exercise03_03oct2022_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="exercise03_03oct2022_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="exercise03_03oct2022_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exercise 03</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Hubert Rehrauer </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 3, 2022</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="exploratory-data-analysis" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h2>
<p>Do an exploratory data analysis of a matrix of expression values. The data consists of expression values for samples that were treated with DMSO and TSA. The samples were measured using three technologies: bulk, IFC96, IFC800. See the two RDS files <code>counts.RDS</code> and <code>phenodata.RDS</code>.</p>
<p>The experiment has two experimental factors “Treatment” and “Technology”. Treatment has two levels, Technology has three levels. Samples that have the same combination of Treatment &amp; Technology are replicates.</p>
</section>
<section id="data-import" class="level2">
<h2 class="anchored" data-anchor-id="data-import">Data Import</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"counts.RDS"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"phenodata.RDS"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(anno)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Treatment Technology
bulk.DMSO-Pre-96IFC        DMSO       bulk
bulk.TSA-Pre-96IFC          TSA       bulk
bulk.DMSO-Pre-800IFC       DMSO       bulk
bulk.TSA-Pre-800IFC         TSA       bulk
bulk.DMSO-Post-800IFC      DMSO       bulk
bulk.TSA-Post-800IFC        TSA       bulk</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load Packages</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pheatmap)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="compute-and-visualize-basic-statistics-on-the-experimental-design" class="level2">
<h2 class="anchored" data-anchor-id="compute-and-visualize-basic-statistics-on-the-experimental-design">Compute and visualize basic statistics on the experimental design</h2>
<p>How many replicates are there for each combination of factor levels? How many genes have an expression value above 0 in each sample? Are there systematic differences between the samples in the different conditions (treatment &amp; technology). Visualize the following statistics per sample:</p>
<p>number of detected genes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21074</code></pre>
</div>
</div>
<p>Number of Replicates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>anno_count<span class="ot">&lt;-</span>anno <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(Technology, Treatment) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Condition=</span><span class="fu">paste</span>(Technology, Treatment, <span class="at">sep=</span><span class="st">" | "</span>))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>anno_count</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Technology Treatment  n     Condition
1       bulk      DMSO  3   bulk | DMSO
2       bulk       TSA  3    bulk | TSA
3     IFC800      DMSO 20 IFC800 | DMSO
4     IFC800       TSA 20  IFC800 | TSA
5      IFC96      DMSO 20  IFC96 | DMSO
6      IFC96       TSA 20   IFC96 | TSA</code></pre>
</div>
</div>
<p>Pie chart for visualisation of Replicates</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Pie chart for visualisation of Replicates</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(anno_count, <span class="fu">aes</span>(<span class="at">x=</span><span class="st">""</span>, <span class="at">y=</span>n, <span class="at">fill=</span>Condition)) <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="st">"y"</span>, <span class="at">start=</span><span class="dv">0</span>) <span class="sc">+</span><span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span><span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n),<span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercise03_03oct2022_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Total sum of counts per sample (serves as a proxy for the number of sequenced reads per sample)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>countreads<span class="ot">&lt;-</span><span class="fu">colSums</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_colnames</span>(<span class="fu">c</span>(<span class="st">"Total Gene Counts"</span>))<span class="sc">%&gt;%</span>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">"ID"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>countreads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                         ID Total Gene Counts
1                       bulk.DMSO-Pre-96IFC          16469072
2                        bulk.TSA-Pre-96IFC          10899777
3                      bulk.DMSO-Pre-800IFC          22928016
4                       bulk.TSA-Pre-800IFC          21170430
5                     bulk.DMSO-Post-800IFC          16572277
6                      bulk.TSA-Post-800IFC          21218842
7      ifc96.LIB018588_GEN00046618_S78_L001            540928
8      ifc96.LIB018588_GEN00046619_S79_L001            476007
9      ifc96.LIB018588_GEN00046620_S80_L001              2086
10     ifc96.LIB018588_GEN00046621_S81_L001            380036
11     ifc96.LIB018588_GEN00046622_S82_L001             17687
12     ifc96.LIB018588_GEN00046623_S83_L001            643503
13     ifc96.LIB018588_GEN00046624_S84_L001            386731
14     ifc96.LIB018588_GEN00046625_S85_L001            672686
15     ifc96.LIB018588_GEN00046626_S86_L001            427782
16     ifc96.LIB018588_GEN00046627_S87_L001            843348
17     ifc96.LIB018588_GEN00046628_S88_L001             14150
18     ifc96.LIB018588_GEN00046629_S89_L001             77791
19     ifc96.LIB018588_GEN00046630_S90_L001            709392
20     ifc96.LIB018588_GEN00046631_S91_L001           1060374
21     ifc96.LIB018588_GEN00046632_S92_L001            685449
22     ifc96.LIB018588_GEN00046633_S93_L001            940623
23     ifc96.LIB018588_GEN00046634_S94_L001            540697
24     ifc96.LIB018588_GEN00046635_S95_L001            562762
25     ifc96.LIB018588_GEN00046636_S96_L001            777012
26     ifc96.LIB018589_GEN00046637_S97_L002            805708
27     ifc96.LIB018589_GEN00046638_S98_L002            861103
28     ifc96.LIB018589_GEN00046639_S99_L002            702540
29    ifc96.LIB018589_GEN00046640_S100_L002            624251
30    ifc96.LIB018589_GEN00046641_S101_L002            768488
31    ifc96.LIB018589_GEN00046642_S102_L002            745517
32    ifc96.LIB018589_GEN00046643_S103_L002            665524
33    ifc96.LIB018589_GEN00046644_S104_L002            586236
34    ifc96.LIB018589_GEN00046645_S105_L002           1500334
35    ifc96.LIB018589_GEN00046646_S106_L002            858754
36    ifc96.LIB018589_GEN00046647_S107_L002            561502
37    ifc96.LIB018589_GEN00046648_S108_L002            841695
38    ifc96.LIB018589_GEN00046649_S109_L002            723380
39    ifc96.LIB018589_GEN00046650_S110_L002            411805
40    ifc96.LIB018589_GEN00046651_S111_L002            866416
41    ifc96.LIB018589_GEN00046652_S112_L002            689852
42    ifc96.LIB018589_GEN00046653_S113_L002           1014098
43    ifc96.LIB018589_GEN00046654_S114_L002           1165663
44    ifc96.LIB018589_GEN00046655_S115_L002           1373293
45    ifc96.LIB018589_GEN00046656_S116_L002           1168779
46      ifc96.LIB018588_GEN00046541_S1_L001            549035
47 ifc800.COL03_ROW01_LIB018723-GEN00047367            173569
48 ifc800.COL03_ROW02_LIB018723-GEN00047367            127311
49 ifc800.COL03_ROW03_LIB018723-GEN00047367             96284
50 ifc800.COL03_ROW04_LIB018723-GEN00047367            216005
51 ifc800.COL03_ROW05_LIB018723-GEN00047367            188145
52 ifc800.COL03_ROW06_LIB018723-GEN00047367             82256
53 ifc800.COL03_ROW07_LIB018723-GEN00047367            144491
54 ifc800.COL03_ROW08_LIB018723-GEN00047367            201587
55 ifc800.COL03_ROW09_LIB018723-GEN00047367            196001
56 ifc800.COL03_ROW10_LIB018723-GEN00047367            154543
57 ifc800.COL03_ROW11_LIB018723-GEN00047367             92759
58 ifc800.COL03_ROW12_LIB018723-GEN00047367            215422
59 ifc800.COL03_ROW13_LIB018723-GEN00047367             87205
60 ifc800.COL03_ROW14_LIB018723-GEN00047367             76190
61 ifc800.COL03_ROW15_LIB018723-GEN00047367            176617
62 ifc800.COL03_ROW16_LIB018723-GEN00047367            114466
63 ifc800.COL03_ROW17_LIB018723-GEN00047367            321129
64 ifc800.COL03_ROW18_LIB018723-GEN00047367             69282
65 ifc800.COL03_ROW19_LIB018723-GEN00047367            118498
66 ifc800.COL03_ROW20_LIB018723-GEN00047367            131727
67 ifc800.COL11_ROW01_LIB018723-GEN00047362              3396
68 ifc800.COL11_ROW02_LIB018723-GEN00047362              1766
69 ifc800.COL11_ROW03_LIB018723-GEN00047362             57408
70 ifc800.COL11_ROW04_LIB018723-GEN00047362              3885
71 ifc800.COL11_ROW05_LIB018723-GEN00047362              4315
72 ifc800.COL11_ROW06_LIB018723-GEN00047362              4291
73 ifc800.COL11_ROW07_LIB018723-GEN00047362            265191
74 ifc800.COL11_ROW08_LIB018723-GEN00047362            176573
75 ifc800.COL11_ROW09_LIB018723-GEN00047362            412753
76 ifc800.COL11_ROW10_LIB018723-GEN00047362            115539
77 ifc800.COL11_ROW11_LIB018723-GEN00047362            160059
78 ifc800.COL11_ROW12_LIB018723-GEN00047362            635846
79 ifc800.COL11_ROW13_LIB018723-GEN00047362            400023
80 ifc800.COL11_ROW14_LIB018723-GEN00047362            114036
81 ifc800.COL11_ROW15_LIB018723-GEN00047362            112770
82 ifc800.COL11_ROW16_LIB018723-GEN00047362              2743
83 ifc800.COL11_ROW17_LIB018723-GEN00047362             77436
84 ifc800.COL11_ROW18_LIB018723-GEN00047362             92052
85 ifc800.COL11_ROW19_LIB018723-GEN00047362            676421
86 ifc800.COL11_ROW20_LIB018723-GEN00047362            204180</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>reads<span class="ot">&lt;-</span><span class="fu">colSums</span>(x <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_colnames</span>(<span class="fu">c</span>(<span class="st">"Number of Non-Zero Genes"</span>))<span class="sc">%&gt;%</span>  </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var=</span><span class="st">"ID"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>reads</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                         ID Number of Non-Zero Genes
1                       bulk.DMSO-Pre-96IFC                    15163
2                        bulk.TSA-Pre-96IFC                    15261
3                      bulk.DMSO-Pre-800IFC                    15404
4                       bulk.TSA-Pre-800IFC                    16182
5                     bulk.DMSO-Post-800IFC                    15202
6                      bulk.TSA-Post-800IFC                    16167
7      ifc96.LIB018588_GEN00046618_S78_L001                     7862
8      ifc96.LIB018588_GEN00046619_S79_L001                     8537
9      ifc96.LIB018588_GEN00046620_S80_L001                      404
10     ifc96.LIB018588_GEN00046621_S81_L001                     7479
11     ifc96.LIB018588_GEN00046622_S82_L001                     7003
12     ifc96.LIB018588_GEN00046623_S83_L001                     8886
13     ifc96.LIB018588_GEN00046624_S84_L001                     9314
14     ifc96.LIB018588_GEN00046625_S85_L001                     8616
15     ifc96.LIB018588_GEN00046626_S86_L001                     5450
16     ifc96.LIB018588_GEN00046627_S87_L001                     7121
17     ifc96.LIB018588_GEN00046628_S88_L001                      557
18     ifc96.LIB018588_GEN00046629_S89_L001                     6697
19     ifc96.LIB018588_GEN00046630_S90_L001                     9123
20     ifc96.LIB018588_GEN00046631_S91_L001                     8138
21     ifc96.LIB018588_GEN00046632_S92_L001                     8781
22     ifc96.LIB018588_GEN00046633_S93_L001                     8199
23     ifc96.LIB018588_GEN00046634_S94_L001                     8987
24     ifc96.LIB018588_GEN00046635_S95_L001                     8948
25     ifc96.LIB018588_GEN00046636_S96_L001                     8845
26     ifc96.LIB018589_GEN00046637_S97_L002                     7644
27     ifc96.LIB018589_GEN00046638_S98_L002                     8639
28     ifc96.LIB018589_GEN00046639_S99_L002                     9019
29    ifc96.LIB018589_GEN00046640_S100_L002                     7882
30    ifc96.LIB018589_GEN00046641_S101_L002                     8858
31    ifc96.LIB018589_GEN00046642_S102_L002                     8027
32    ifc96.LIB018589_GEN00046643_S103_L002                     8793
33    ifc96.LIB018589_GEN00046644_S104_L002                     7550
34    ifc96.LIB018589_GEN00046645_S105_L002                     7126
35    ifc96.LIB018589_GEN00046646_S106_L002                     7830
36    ifc96.LIB018589_GEN00046647_S107_L002                     9012
37    ifc96.LIB018589_GEN00046648_S108_L002                     7808
38    ifc96.LIB018589_GEN00046649_S109_L002                     8691
39    ifc96.LIB018589_GEN00046650_S110_L002                     8340
40    ifc96.LIB018589_GEN00046651_S111_L002                     8389
41    ifc96.LIB018589_GEN00046652_S112_L002                     9379
42    ifc96.LIB018589_GEN00046653_S113_L002                     7721
43    ifc96.LIB018589_GEN00046654_S114_L002                     7897
44    ifc96.LIB018589_GEN00046655_S115_L002                     7649
45    ifc96.LIB018589_GEN00046656_S116_L002                     7690
46      ifc96.LIB018588_GEN00046541_S1_L001                     9392
47 ifc800.COL03_ROW01_LIB018723-GEN00047367                     5537
48 ifc800.COL03_ROW02_LIB018723-GEN00047367                     5169
49 ifc800.COL03_ROW03_LIB018723-GEN00047367                     4166
50 ifc800.COL03_ROW04_LIB018723-GEN00047367                     6179
51 ifc800.COL03_ROW05_LIB018723-GEN00047367                     5786
52 ifc800.COL03_ROW06_LIB018723-GEN00047367                     4271
53 ifc800.COL03_ROW07_LIB018723-GEN00047367                     5240
54 ifc800.COL03_ROW08_LIB018723-GEN00047367                     6057
55 ifc800.COL03_ROW09_LIB018723-GEN00047367                     5980
56 ifc800.COL03_ROW10_LIB018723-GEN00047367                     5509
57 ifc800.COL03_ROW11_LIB018723-GEN00047367                     4457
58 ifc800.COL03_ROW12_LIB018723-GEN00047367                     6150
59 ifc800.COL03_ROW13_LIB018723-GEN00047367                     4168
60 ifc800.COL03_ROW14_LIB018723-GEN00047367                     4319
61 ifc800.COL03_ROW15_LIB018723-GEN00047367                     5738
62 ifc800.COL03_ROW16_LIB018723-GEN00047367                     4586
63 ifc800.COL03_ROW17_LIB018723-GEN00047367                     7535
64 ifc800.COL03_ROW18_LIB018723-GEN00047367                     3928
65 ifc800.COL03_ROW19_LIB018723-GEN00047367                     4949
66 ifc800.COL03_ROW20_LIB018723-GEN00047367                     4920
67 ifc800.COL11_ROW01_LIB018723-GEN00047362                     1456
68 ifc800.COL11_ROW02_LIB018723-GEN00047362                      810
69 ifc800.COL11_ROW03_LIB018723-GEN00047362                     3787
70 ifc800.COL11_ROW04_LIB018723-GEN00047362                     1720
71 ifc800.COL11_ROW05_LIB018723-GEN00047362                     1661
72 ifc800.COL11_ROW06_LIB018723-GEN00047362                     1564
73 ifc800.COL11_ROW07_LIB018723-GEN00047362                     6811
74 ifc800.COL11_ROW08_LIB018723-GEN00047362                     5729
75 ifc800.COL11_ROW09_LIB018723-GEN00047362                     8379
76 ifc800.COL11_ROW10_LIB018723-GEN00047362                     5157
77 ifc800.COL11_ROW11_LIB018723-GEN00047362                     5840
78 ifc800.COL11_ROW12_LIB018723-GEN00047362                     9272
79 ifc800.COL11_ROW13_LIB018723-GEN00047362                     8320
80 ifc800.COL11_ROW14_LIB018723-GEN00047362                     5239
81 ifc800.COL11_ROW15_LIB018723-GEN00047362                     5442
82 ifc800.COL11_ROW16_LIB018723-GEN00047362                     1125
83 ifc800.COL11_ROW17_LIB018723-GEN00047362                     4682
84 ifc800.COL11_ROW18_LIB018723-GEN00047362                     5005
85 ifc800.COL11_ROW19_LIB018723-GEN00047362                     9074
86 ifc800.COL11_ROW20_LIB018723-GEN00047362                     6029</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Get the Conditions for all the replicates</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>anno <span class="ot">=</span> anno <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Condition=</span><span class="fu">paste</span>(Technology, Treatment, <span class="at">sep=</span><span class="st">" | "</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Histogramm for Total counts</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(countreads, <span class="fu">aes</span>(<span class="at">x=</span>ID,<span class="at">y=</span><span class="st">`</span><span class="at">Total Gene Counts</span><span class="st">`</span>,<span class="at">fill=</span>anno<span class="sc">$</span>Condition)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sample ID"</span>, <span class="at">fill =</span> <span class="st">"Condition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercise03_03oct2022_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Visualisation and Color the samples by the experimental condition.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Histogramm for the nr of nonzero reads across all the samples</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(reads, <span class="fu">aes</span>(<span class="at">x=</span>ID,<span class="at">y=</span><span class="st">`</span><span class="at">Number of Non-Zero Genes</span><span class="st">`</span>,<span class="at">fill=</span>anno<span class="sc">$</span>Condition)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sample ID"</span>, <span class="at">fill =</span> <span class="st">"Condition"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercise03_03oct2022_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="normalize-the-data" class="level2">
<h2 class="anchored" data-anchor-id="normalize-the-data">Normalize the data</h2>
<p>Scale the columns so that the total sum of all columns are identical</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>x_T <span class="ot">=</span> <span class="fu">sweep</span>(x, <span class="dv">2</span>, <span class="fu">colSums</span>(x) <span class="sc">/</span> <span class="fu">mean</span>(<span class="fu">colSums</span>(x)), <span class="at">FUN=</span><span class="st">"/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="transform-the-data-to-log-scale" class="level2">
<h2 class="anchored" data-anchor-id="transform-the-data-to-log-scale">Transform the data to log-scale</h2>
<p>Use the function <code>log1p</code> to transform the data to log-scale</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>x_T_log <span class="ot">&lt;-</span> <span class="fu">log1p</span>(x_T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="visualize-the-distribution-of-the-expression-values" class="level2">
<h2 class="anchored" data-anchor-id="visualize-the-distribution-of-the-expression-values">Visualize the distribution of the expression values</h2>
<p>Use violin plots and boxplots to visualize the distribution of the expression values. Aggregate the replicates in the same experimental group into one average sample, and plot the averaged sample. Color by experimental factors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create anno_s with all information summarized</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>anno_s <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">rowid_to_column</span>(anno, <span class="st">"Sample"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, as.factor)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>anno_s<span class="sc">$</span>Samplename <span class="ot">&lt;-</span> <span class="fu">as.character</span>(<span class="fu">row.names</span>(anno))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Aggregate the replicates in the same experimental group into one average sample</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>x_T_log_agg <span class="ot">&lt;-</span> x_T_log</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(x_T_log_agg) <span class="ot">&lt;-</span>anno_s<span class="sc">$</span>Condition</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>x_T_log_agg<span class="ot">&lt;-</span><span class="fu">sapply</span>(<span class="fu">split</span>(<span class="fu">seq_len</span>(<span class="fu">ncol</span>(x_T_log_agg)),<span class="fu">colnames</span>(x_T_log_agg)),<span class="cf">function</span>(cis) <span class="fu">rowMeans</span>(x_T_log_agg[,cis,<span class="at">drop=</span>F]));</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Aggregated datafile</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(x_T_log_agg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           bulk | DMSO bulk | TSA IFC800 | DMSO IFC800 | TSA IFC96 | DMSO
OR4F5       0.03206338 0.00000000      0.000000    0.0000000    0.0000000
FO538757.3  0.03206338 0.05035393      0.000000    0.0000000    0.0000000
FO538757.2  2.85602871 2.82251151      2.174755    0.4302072    0.8322766
OR4F29      0.00000000 0.00000000      0.000000    0.0000000    0.0000000
OR4F16      0.00000000 0.00000000      0.000000    0.0000000    0.0000000
LINC01128   0.49870947 0.77067468      0.000000    0.0000000    0.6525062
           IFC96 | TSA
OR4F5        0.0000000
FO538757.3   0.0000000
FO538757.2   0.4678182
OR4F29       0.0000000
OR4F16       0.0000000
LINC01128    0.0000000</code></pre>
</div>
</div>
<p>Violin Plots</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Violin Plots with quantiles</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(x_T_log_agg) <span class="sc">%&gt;%</span>  </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to=</span><span class="st">"Expression"</span>, <span class="at">names_to=</span><span class="st">"Condition"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span><span class="fu">geom_violin</span>(<span class="fu">aes</span>(<span class="at">x=</span>Condition, <span class="at">y=</span>Expression,<span class="at">col=</span>Condition),<span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)<span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercise03_03oct2022_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Boxplots</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Boxplots</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(x_T_log_agg) <span class="sc">%&gt;%</span>  </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">values_to=</span><span class="st">"Expression"</span>, <span class="at">names_to=</span><span class="st">"Condition"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Condition, <span class="at">y=</span>Expression,<span class="at">col=</span>Condition))<span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">"none"</span>)<span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans=</span><span class="st">'log10'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercise03_03oct2022_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="most-variable-genes" class="level2">
<h2 class="anchored" data-anchor-id="most-variable-genes">Most variable genes</h2>
<p>Identify the 500 most variable genes (with largest variance across samples) and continue working with those</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>var_gen <span class="ot">=</span> x_T_log[<span class="fu">head</span>(<span class="fu">order</span>(<span class="fu">apply</span>(x_T_log, <span class="dv">1</span>, sd), <span class="at">decreasing=</span><span class="cn">TRUE</span>), <span class="dv">500</span>), ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sample-correlations" class="level2">
<h2 class="anchored" data-anchor-id="sample-correlations">Sample correlations</h2>
<p>Compute and visualize the sample-to-sample correlations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>var_gen_cor <span class="ot">&lt;-</span> <span class="fu">cor</span>(var_gen)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(var_gen_cor, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">tl.pos=</span><span class="st">'n'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercise03_03oct2022_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="clustering" class="level2">
<h2 class="anchored" data-anchor-id="clustering">Clustering</h2>
<p>Compute and visualize a hierarchical clustering of the samples, use the method <code>hclust</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>x_dist <span class="ot">&lt;-</span> <span class="fu">dist</span>(<span class="fu">t</span>(var_gen))</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>x_hclust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(x_dist)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x_hclust, <span class="at">xlab =</span> <span class="st">"Sample"</span>, <span class="at">sub =</span> <span class="st">""</span>, <span class="at">cex=</span><span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercise03_03oct2022_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="heatmap" class="level2">
<h2 class="anchored" data-anchor-id="heatmap">Heatmap</h2>
<p>Use the package <code>pheatmap</code> to generate a heatmap of the expression data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>cluster<span class="ot">&lt;-</span><span class="fu">select</span>(anno_s,Condition)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">row.names</span>(cluster) <span class="ot">=</span> anno_s<span class="sc">$</span>Samplename</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">pheatmap</span>(var_gen, <span class="at">show_colnames =</span> <span class="cn">FALSE</span>, <span class="at">show_rownames =</span> <span class="cn">FALSE</span>, <span class="at">annotation_col =</span> cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="exercise03_03oct2022_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>